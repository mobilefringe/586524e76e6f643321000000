<div class="blogpost">
    <div id="post_container">
        <script id="post_template" type="x-tmpl-mustache/text">
            <h1>
                <a href="/posts" class="back_to">
                    <img src="//codecloud.cdn.speedyrails.net/sites/586524e76e6f643321000000/image/png/1497369767000/back_btn.png" />
                </a>
                {{title}}
            </h1>
            <p>{{publish_date}} + {{ author_name }}</p>
            <img src="{{post_image}}" />
                
            <p>{{{html_body}}}</p>
        </script>
    </div>
    <!-- DISQUS start -->
    <div id="disqus_thread"></div>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    <!-- DISQUS end -->
</div>
<script>
$(document).ready(function(e) {
    init(e);
    function renderAll (){
        var pathArray = window.location.pathname.split( '/' );
        var slug = pathArray[pathArray.length-1];
        var post = getPostDetailsBySlug(slug);
        renderPostDetails("#post_container", "#post_template", post);
        
        setTimeout(function() {
            show_content();
        }, 500);
    
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'marlboroughmall'; // required: replace example with your forum shortname
        /* * * DON'T EDIT BELOW THIS LINE * * */
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }
    loadMallDataCached(renderAll); 
    
    function renderPostDetails(container, template, post_details){
        var item_list = [];
        var template_html = $(template).html();
        Mustache.parse(template_html);   // optional, speeds up future uses
        
        console.log(post_details)
        if (post_details.image_url != null || post_details.image_url != undefined) {
            post_details.post_image = post_details.image_url;
        } else {
            post_details.post_image = "//codecloud.cdn.speedyrails.net/sites/586524e76e6f643321000000/image/jpeg/1497450277000/marlborough_logo.jpg";
        }
        
        if (post_details.author != null || post_details.author != "") {
            post_details.author_name = post_details.author;
        } else {
            post_details.author_name = "Marlborough Mall"
        }
        
        var published_on = moment(post_details.publish_date).tz(getPropertyTimeZone());
        post_details.publish_date = published_on.format("MMMM Do, YYYY");

        var rendered = Mustache.render(template_html, post_details);
        item_list.push(rendered);
        $(container).html(item_list.join(''));
    }
})
</script>